{% if no_data %}
    <div style="padding:2rem; text-align:center; color:var(--color-text-muted);">Aucune donnée disponible</div>
{% elif no_errors %}
    <div style="padding:2rem; text-align:center; color:var(--color-text-muted);">Aucune erreur à afficher</div>
{% else %}

<div style="display:flex; flex-direction:column; gap:1.5rem;">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:1.5rem;">
        <div style="background:var(--color-surface); border:1px solid var(--color-border); border-radius:var(--radius); padding:1.5rem;">
            <h4 style="font-size:1.05rem; font-weight:700; margin:0 0 1rem 0; color:var(--color-text);">Top 3 erreurs (EVI + Downstream)</h4>
            {% if top_all %}
            <div class="mac-table-container">
                <table class="mac-table" id="top-all-table">
                    <thead>
                        <tr>
                            <th class="sortable">Moment</th>
                            <th class="sortable">Step</th>
                            <th class="sortable">Code</th>
                            <th class="sortable">Type</th>
                            <th class="sortable" data-type="number">Occurrences</th>
                            <th class="sortable" data-type="number">%</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in top_all %}
                        <tr>
                            <td>{{ row.moment_label }}</td>
                            <td>{{ row.step }}</td>
                            <td>{{ row.code }}</td>
                            <td>{{ row.type }}</td>
                            <td style="text-align:right;" data-sort-value="{{ row.Occurrences }}">{{ row.Occurrences }}</td>
                            <td style="text-align:right;" data-sort-value="{{ '%.2f'|format(row.percent) }}">{{ '%.2f'|format(row.percent) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="padding:1rem; color:var(--color-text-muted); text-align:center;">Aucune erreur</div>
            {% endif %}
        </div>

        <div style="background:var(--color-surface); border:1px solid var(--color-border); border-radius:var(--radius); padding:1.5rem;">
            <h4 style="font-size:1.05rem; font-weight:700; margin:0 0 1rem 0; color:var(--color-text);">Détail Top 3 par site</h4>
            {% if detail_all_pivot.columns %}
            <div class="mac-table-container" style="max-height:400px;">
                <table class="mac-table" id="detail-all-table">
                    <thead>
                        <tr>
                            {% for col in detail_all_pivot.columns %}
                            <th class="sortable {% if col != 'Site' and col != 'Total Charges' %}multiline{% endif %}" {% if col != 'Site' %}data-type="number"{% endif %}>{{ col }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in detail_all_pivot.rows %}
                        <tr>
                            {% for col in detail_all_pivot.columns %}
                            <td style="text-align:{{ 'left' if col == 'Site' else 'right' }};">{{ row[col] }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="padding:1rem; color:var(--color-text-muted); text-align:center;">Aucun détail</div>
            {% endif %}
        </div>
    </div>
</div>

<script>
(function() {
    if (typeof initTables === 'function') initTables();
    if (typeof initCharts === 'function') initCharts();
})();
</script>
{% endif %}
